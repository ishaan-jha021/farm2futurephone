<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#FAFAF9">
    <title>Farm2Future App</title>
    
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* --- APP DESIGN SYSTEM --- */
        :root {
            --forest-green: #0F392B;
            --forest-light: #1A523E;
            --sage: #8DA399;
            --sage-light: #E8F0ED;
            --cream: #FAFAF9;
            --white: #FFFFFF;
            --charcoal: #1C1C1E;
            --grey-mid: #8E8E93;
            --grey-light: #F2F2F7;
            
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
            
            --header-height: 60px;
            --tab-bar-height: 65px;
            
            --radius-md: 16px;
            --shadow-subtle: 0 4px 20px rgba(0,0,0,0.03);
        }

        /* --- RESET & APP SHELL --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
            background-color: var(--cream);
            color: var(--charcoal);
            height: 100vh;
            overflow: hidden; /* Prevent body scroll, we scroll internal views */
            display: flex;
            flex-direction: column;
        }

        h1, h2, h3, h4 { font-family: 'DM Sans', sans-serif; color: var(--forest-green); margin: 0; }
        button { border: none; background: none; font-family: inherit; cursor: pointer; }

        /* --- TOP APP BAR --- */
        .app-header {
            height: calc(var(--header-height) + var(--safe-top));
            padding-top: var(--safe-top);
            background: rgba(250, 250, 249, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-left: 20px;
            padding-right: 20px;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 100;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .logo { font-weight: 700; font-size: 1.2rem; color: var(--forest-green); display: flex; align-items: center; gap: 8px; }
        .header-actions { display: flex; gap: 16px; }

        /* --- SCROLLABLE CONTENT AREA --- */
        #main-container {
            flex: 1;
            overflow-y: auto;
            scroll-behavior: smooth;
            padding-top: calc(var(--header-height) + var(--safe-top));
            padding-bottom: calc(var(--tab-bar-height) + var(--safe-bottom) + 20px);
            -webkit-overflow-scrolling: touch; /* Smooth scroll on iOS */
        }

        /* Hide Scrollbar */
        #main-container::-webkit-scrollbar { display: none; }

        /* --- VIEWS --- */
        .page-view { display: none; padding: 20px; animation: fadeIn 0.3s ease; }
        .page-view.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- BOTTOM TAB BAR --- */
        .tab-bar {
            height: calc(var(--tab-bar-height) + var(--safe-bottom));
            padding-bottom: var(--safe-bottom);
            background: var(--white);
            position: fixed;
            bottom: 0;
            width: 100%;
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid rgba(0,0,0,0.05);
            z-index: 100;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.03);
        }

        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--grey-mid);
            font-size: 0.7rem;
            gap: 4px;
            width: 100%;
            height: 100%;
            transition: color 0.2s;
        }

        .tab-item.active { color: var(--forest-green); }
        .tab-item i { transition: transform 0.2s; }
        .tab-item.active i { transform: translateY(-2px); }

        /* --- COMPONENTS --- */
        .btn {
            padding: 12px 20px;
            border-radius: 100px;
            font-weight: 600;
            font-size: 0.95rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.96); }
        .btn-primary { background: var(--forest-green); color: white; width: 100%; box-shadow: 0 4px 12px rgba(15, 57, 43, 0.2); }
        .btn-secondary { background: var(--white); color: var(--forest-green); border: 1px solid rgba(15, 57, 43, 0.1); width: 100%; }
        .btn-sm { padding: 8px 16px; font-size: 0.85rem; width: auto; }

        .card {
            background: var(--white);
            border-radius: var(--radius-md);
            padding: 16px;
            box-shadow: var(--shadow-subtle);
            border: 1px solid rgba(0,0,0,0.03);
            margin-bottom: 16px;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 100px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            display: inline-block;
        }
        .badge-sage { background: var(--sage-light); color: var(--forest-green); }

        /* --- HOME HERO --- */
        .hero-card {
            background: var(--forest-green);
            color: white;
            padding: 30px 20px;
            border-radius: 24px;
            text-align: center;
            margin-bottom: 24px;
        }
        .hero-card h1 { color: white; font-size: 1.8rem; margin-bottom: 12px; }
        .hero-card p { opacity: 0.9; font-size: 0.95rem; margin-bottom: 20px; }

        /* --- MARKETPLACE GRID --- */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        
        .product-card {
            background: var(--white);
            border-radius: var(--radius-md);
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }
        .product-img {
            height: 120px;
            background: var(--grey-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
        }
        .product-info { padding: 12px; display: flex; flex-direction: column; flex: 1; }
        .product-name { font-weight: 600; font-size: 0.95rem; line-height: 1.2; margin-bottom: 4px; }
        .product-meta { font-size: 0.75rem; color: var(--grey-mid); margin-bottom: 8px; }
        .product-price { font-weight: 700; color: var(--forest-green); margin-top: auto; display: flex; justify-content: space-between; align-items: center; }

        /* --- FILTERS (Horizontal Scroll) --- */
        .filters-scroll {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 10px;
            margin-bottom: 16px;
            scrollbar-width: none;
        }
        .filters-scroll::-webkit-scrollbar { display: none; }
        .filter-chip {
            white-space: nowrap;
            padding: 8px 16px;
            border-radius: 100px;
            background: var(--white);
            border: 1px solid rgba(0,0,0,0.1);
            font-size: 0.85rem;
            color: var(--charcoal);
        }
        .filter-chip.active { background: var(--forest-green); color: white; border-color: var(--forest-green); }

        /* --- DEMAND BARS --- */
        .progress-track { height: 6px; background: var(--grey-light); border-radius: 10px; margin: 10px 0; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--forest-green); width: 0; transition: width 1s; }

        /* --- MODAL (Bottom Sheet Style) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 1000;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
            display: flex; align-items: flex-end; /* Align to bottom */
        }
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        
        .bottom-sheet {
            background: var(--white);
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border-radius: 24px 24px 0 0;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.1, 0.9, 0.2, 1);
            padding: 24px;
            padding-bottom: calc(var(--safe-bottom) + 20px);
        }
        .modal-overlay.active .bottom-sheet { transform: translateY(0); }
        
        .sheet-handle {
            width: 40px; height: 5px; background: var(--grey-light);
            border-radius: 10px; margin: 0 auto 20px;
        }

        /* --- WIZARD --- */
        .wizard-step { display: none; text-align: center; }
        .wizard-step.active { display: block; animation: fadeIn 0.4s; }
        .option-btn {
            background: var(--white); border: 2px solid var(--grey-light);
            padding: 16px; border-radius: 12px; margin-bottom: 10px; width: 100%;
            text-align: left; transition: all 0.2s;
        }
        .option-btn.selected { border-color: var(--forest-green); background: var(--sage-light); }
        
    </style>
</head>
<body>

    <header class="app-header">
        <div class="logo">
            <i data-lucide="sprout"></i> Farm2Future
        </div>
        <div class="header-actions">
            <i data-lucide="bell" size="22" color="#555"></i>
            <div style="width: 28px; height: 28px; background: #ddd; border-radius: 50%;"></div> </div>
    </header>

    <main id="main-container">
        
        <div id="view-home" class="page-view active">
            <div class="hero-card">
                <h1>Pure Food.<br>Zero Waste.</h1>
                <p>Track your food from soil to plate.</p>
                <button class="btn" style="background: white; color: var(--forest-green);" onclick="switchTab('marketplace')">
                    Start Shopping
                </button>
            </div>

            <h3 style="margin-bottom: 16px;">Quick Actions</h3>
            <div style="display: flex; gap: 12px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none;">
                <div class="card" style="min-width: 140px; text-align: center;" onclick="switchTab('smartbasket')">
                    <div style="background: var(--sage-light); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 10px;">
                        <i data-lucide="brain-circuit" size="20" color="var(--forest-green)"></i>
                    </div>
                    <span style="font-weight: 600; font-size: 0.9rem;">AI Basket</span>
                </div>
                <div class="card" style="min-width: 140px; text-align: center;" onclick="switchTab('demand')">
                    <div style="background: var(--sage-light); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 10px;">
                        <i data-lucide="tractor" size="20" color="var(--forest-green)"></i>
                    </div>
                    <span style="font-weight: 600; font-size: 0.9rem;">Pre-Order</span>
                </div>
                <div class="card" style="min-width: 140px; text-align: center;">
                    <div style="background: var(--sage-light); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 10px;">
                        <i data-lucide="scan-line" size="20" color="var(--forest-green)"></i>
                    </div>
                    <span style="font-weight: 600; font-size: 0.9rem;">Scan QR</span>
                </div>
            </div>

            <h3 style="margin: 20px 0 16px;">Trending Now</h3>
            <div class="grid-2" id="home-trending-grid">
                </div>
        </div>

        <div id="view-marketplace" class="page-view">
            <div style="position: sticky; top: 0; background: var(--cream); z-index: 10; padding-bottom: 10px;">
                <h2 style="margin-bottom: 16px;">Marketplace</h2>
                <div class="filters-scroll">
                    <button class="filter-chip active" onclick="filterMarket('all', this)">All</button>
                    <button class="filter-chip" onclick="filterMarket('Vegetable', this)">Veggies</button>
                    <button class="filter-chip" onclick="filterMarket('Fruit', this)">Fruits</button>
                    <button class="filter-chip" onclick="filterMarket('Dairy', this)">Dairy</button>
                </div>
            </div>
            
            <div class="grid-2" id="marketplace-grid">
                </div>
        </div>

        <div id="view-smartbasket" class="page-view">
            <h2 style="margin-bottom: 10px;">AI Nutritionist</h2>
            <p style="color: var(--grey-mid); font-size: 0.9rem; margin-bottom: 24px;">Let Gemini AI build your perfect weekly basket.</p>
            
            <div class="card" style="text-align: center; padding: 40px 20px;">
                <div id="wiz-step-1" class="wizard-step active">
                    <i data-lucide="heart-pulse" size="48" color="var(--forest-green)" style="margin-bottom: 20px;"></i>
                    <h3 style="margin-bottom: 20px;">What's your goal?</h3>
                    <button class="option-btn" onclick="nextWizStep(2)">ðŸ©¸ Manage Diabetes</button>
                    <button class="option-btn" onclick="nextWizStep(2)">ðŸ’ª Build Muscle</button>
                    <button class="option-btn" onclick="nextWizStep(2)">ðŸ¥— General Wellness</button>
                </div>

                <div id="wiz-step-2" class="wizard-step">
                    <i data-lucide="chef-hat" size="48" color="var(--forest-green)" style="margin-bottom: 20px;"></i>
                    <h3 style="margin-bottom: 20px;">Diet Preference?</h3>
                    <button class="option-btn" onclick="finishWiz()">Vegetarian</button>
                    <button class="option-btn" onclick="finishWiz()">Vegan</button>
                    <button class="option-btn" onclick="finishWiz()">No Restrictions</button>
                </div>

                <div id="wiz-step-loading" class="wizard-step">
                    <i data-lucide="loader-2" class="spin" size="48" color="var(--forest-green)"></i>
                    <h3 style="margin-top: 20px;">Curating Basket...</h3>
                </div>

                <div id="wiz-step-result" class="wizard-step">
                    <div style="background: var(--sage-light); padding: 15px; border-radius: 12px; margin-bottom: 20px; text-align: left;">
                        <strong style="color: var(--forest-green); font-size: 0.8rem;">AI INSIGHT</strong>
                        <p style="font-size: 0.85rem; margin-top: 5px;">Optimized for low glycemic index and high fiber content.</p>
                    </div>
                    <div style="text-align: left; margin-bottom: 20px;">
                        <div style="display:flex; justify-content:space-between; margin-bottom:8px;"><span>Spinach</span><span>â‚¹45</span></div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:8px;"><span>Carrots</span><span>â‚¹55</span></div>
                        <div style="display:flex; justify-content:space-between; border-top:1px solid #eee; padding-top:8px;"><strong>Total</strong><strong>â‚¹100</strong></div>
                    </div>
                    <button class="btn btn-primary">Subscribe & Save</button>
                    <button class="btn btn-secondary" style="margin-top: 10px;" onclick="resetWiz()">Start Over</button>
                </div>
            </div>
        </div>

        <div id="view-demand" class="page-view">
            <h2 style="margin-bottom: 10px;">Demand Farming</h2>
            <p style="color: var(--grey-mid); font-size: 0.9rem; margin-bottom: 24px;">Pre-book crops. Farmers grow for <i>you</i>.</p>

            <div id="demand-list">
                </div>
        </div>

    </main>

    <nav class="tab-bar">
        <div class="tab-item active" onclick="switchTab('home')">
            <i data-lucide="home" size="22"></i>
            <span>Home</span>
        </div>
        <div class="tab-item" onclick="switchTab('marketplace')">
            <i data-lucide="store" size="22"></i>
            <span>Shop</span>
        </div>
        <div class="tab-item" onclick="switchTab('smartbasket')">
            <i data-lucide="shopping-basket" size="22"></i>
            <span>Basket</span>
        </div>
        <div class="tab-item" onclick="switchTab('demand')">
            <i data-lucide="sprout" size="22"></i>
            <span>Grow</span>
        </div>
    </nav>

    <div class="modal-overlay" id="farmerSheet">
        <div class="bottom-sheet">
            <div class="sheet-handle"></div>
            <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 20px;">
                <div style="width: 60px; height: 60px; background: #ddd; border-radius: 50%;"></div>
                <div>
                    <h3 id="sheet-name">Farmer Name</h3>
                    <p id="sheet-loc" style="color: var(--grey-mid); font-size: 0.85rem;">Location</p>
                </div>
                <div style="margin-left: auto; text-align: center; background: var(--sage-light); padding: 8px 12px; border-radius: 12px;">
                    <div style="font-weight: 700; color: var(--forest-green);">98</div>
                    <div style="font-size: 0.65rem;">SCORE</div>
                </div>
            </div>
            <p style="font-size: 0.9rem; line-height: 1.5; color: #444; margin-bottom: 24px;">
                Practices zero-budget natural farming. Uses jeevamrutham for soil health and neem oil for pest control.
            </p>
            <button class="btn btn-primary" onclick="closeSheet('farmerSheet')">View Products</button>
        </div>
    </div>

    <script>
        // Init Icons
        lucide.createIcons();

        // --- DATA ---
        const products = [
            { id: 1, name: 'Heritage Spinach', type: 'Vegetable', price: 45, unit: 'bunch', img: 'ðŸ¥¬', farm: 'Gopal' },
            { id: 2, name: 'Vine Tomatoes', type: 'Vegetable', price: 60, unit: 'kg', img: 'ðŸ…', farm: 'Anita' },
            { id: 3, name: 'A2 Ghee', type: 'Dairy', price: 900, unit: '500ml', img: 'ðŸ§ˆ', farm: 'Vedic' },
            { id: 4, name: 'Kashmiri Apples', type: 'Fruit', price: 180, unit: 'kg', img: 'ðŸŽ', farm: 'Ahmed' },
            { id: 5, name: 'Desi Carrots', type: 'Vegetable', price: 55, unit: 'kg', img: 'ðŸ¥•', farm: 'Laxmi' },
            { id: 6, name: 'Free Range Eggs', type: 'Dairy', price: 120, unit: '6pcs', img: 'ðŸ¥š', farm: 'Happy' }
        ];

        const demandItems = [
            { name: 'Basmati Rice', farmer: 'Rajesh Kumar', funded: 72, img: 'ðŸŒ¾' },
            { name: 'Lakadong Turmeric', farmer: 'Mary Rymbai', funded: 90, img: 'ðŸ§‚' },
            { name: 'Alphonso Mango', farmer: 'Vilas Patil', funded: 35, img: 'ðŸ¥­' }
        ];

        // --- RENDER FUNCTIONS ---
        function renderMarketplace(filter = 'all') {
            const grid = document.getElementById('marketplace-grid');
            const homeGrid = document.getElementById('home-trending-grid');
            grid.innerHTML = '';
            
            // Just putting first 4 in home for demo
            if(homeGrid) homeGrid.innerHTML = '';

            const filtered = filter === 'all' ? products : products.filter(p => p.type === filter);

            filtered.forEach(item => {
                const html = `
                    <div class="product-card">
                        <div class="product-img">${item.img}</div>
                        <div class="product-info">
                            <div class="product-name">${item.name}</div>
                            <div class="product-meta">${item.farm} Farms</div>
                            <div class="product-price">
                                â‚¹${item.price}<span style="font-size:0.7rem; font-weight:400; color:#888">/${item.unit}</span>
                                <button onclick="openSheet('farmerSheet')" style="background:var(--sage-light); width:24px; height:24px; display:flex; align-items:center; justify-content:center; border-radius:50%; color:var(--forest-green)">
                                    <i data-lucide="info" size="14"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                grid.innerHTML += html;
                if(homeGrid && products.indexOf(item) < 4) homeGrid.innerHTML += html;
            });
            lucide.createIcons();
        }

        function renderDemand() {
            const list = document.getElementById('demand-list');
            demandItems.forEach(item => {
                list.innerHTML += `
                    <div class="card" style="display:flex; gap:16px; align-items:center;">
                        <div style="font-size:2rem; background:var(--grey-light); width:60px; height:60px; border-radius:12px; display:flex; align-items:center; justify-content:center;">${item.img}</div>
                        <div style="flex:1;">
                            <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                                <strong>${item.name}</strong>
                                <span style="font-size:0.8rem; color:var(--forest-green); font-weight:700;">${item.funded}%</span>
                            </div>
                            <div class="progress-track"><div class="progress-fill" style="width:${item.funded}%"></div></div>
                            <div style="font-size:0.75rem; color:var(--grey-mid);">Farmer: ${item.farmer}</div>
                        </div>
                        <button class="btn btn-primary btn-sm">Book</button>
                    </div>
                `;
            });
        }

        // --- NAVIGATION ---
        function switchTab(viewId) {
            // Hide all views
            document.querySelectorAll('.page-view').forEach(el => el.classList.remove('active'));
            // Show target
            document.getElementById('view-' + viewId).classList.add('active');
            
            // Update Tab Icons
            document.querySelectorAll('.tab-item').forEach(el => el.classList.remove('active'));
            // Find the clicked tab (simple logic for demo)
            const tabs = ['home', 'marketplace', 'smartbasket', 'demand'];
            const index = tabs.indexOf(viewId);
            if(index > -1) document.querySelectorAll('.tab-item')[index].classList.add('active');
            
            // Scroll to top
            document.getElementById('main-container').scrollTop = 0;
        }

        function filterMarket(type, btn) {
            document.querySelectorAll('.filter-chip').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderMarketplace(type);
        }

        // --- MODAL/SHEET ---
        function openSheet(id) {
            document.getElementById(id).classList.add('active');
        }
        function closeSheet(id) {
            document.getElementById(id).classList.remove('active');
        }
        // Close on backdrop click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if(e.target === overlay) overlay.classList.remove('active');
            });
        });

        // --- WIZARD MOCK ---
        function nextWizStep(n) {
            document.getElementById(`wiz-step-${n-1}`).classList.remove('active');
            document.getElementById(`wiz-step-${n}`).classList.add('active');
        }
        function finishWiz() {
            document.getElementById('wiz-step-2').classList.remove('active');
            document.getElementById('wiz-step-loading').classList.add('active');
            setTimeout(() => {
                document.getElementById('wiz-step-loading').classList.remove('active');
                document.getElementById('wiz-step-result').classList.add('active');
            }, 1500);
        }
        function resetWiz() {
            document.getElementById('wiz-step-result').classList.remove('active');
            document.getElementById('wiz-step-1').classList.add('active');
        }

        // --- INIT ---
        window.onload = () => {
            renderMarketplace();
            renderDemand();
            // Animation for spinner
            const style = document.createElement('style');
            style.innerHTML = `@keyframes spin { 100% { transform: rotate(360deg); } } .spin { animation: spin 1s linear infinite; }`;
            document.head.appendChild(style);
        };

    </script>
</body>
</html>